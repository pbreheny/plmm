<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="penalizedLMM">
<title>Inference with marginal false discovery rates • penalizedLMM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Inference with marginal false discovery rates">
<meta property="og:description" content="penalizedLMM">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">penalizedLMM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/choose_k.html">Choosing k -- an eigenproblem</a>
    <a class="dropdown-item" href="../articles/explore_options.html">Exploring different modeling options</a>
    <a class="dropdown-item" href="../articles/mfdr.html">Inference with marginal false discovery rates</a>
    <a class="dropdown-item" href="../articles/plink-files.html">Processing PLINK files</a>
    <a class="dropdown-item" href="../articles/getting-started.html">Getting started with penalizedLMM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Inference with marginal false discovery rates</h1>
            
      
      
      <div class="d-none name"><code>mfdr.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">penalizedLMM</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span> <span class="co"># for fread()</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># for mutate() and bind_rows()</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span> <span class="co"># for rownames_to_column() and other data cleaning funs.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="background-and-motivation">Background and motivation<a class="anchor" aria-label="anchor" href="#background-and-motivation"></a>
</h2>
<p>While cross validation (as in <code><a href="../reference/cv.plmm.html">cv.plmm()</a></code>) serves as a
method for assessing a model’s ability to predict outcomes in new data,
cross validation is not geared towards making <em>inferences</em> about
the <span class="math inline">\(\hat \beta\)</span> values
(coefficients) estimated by a model. When we use a PLMM, we often want
to answer questions like:</p>
<ul>
<li><p>“How reliable are the selections made by the model I
chose?”</p></li>
<li><p>“How accurate are the estimated <span class="math inline">\(\hat
\beta\)</span> values?”</p></li>
</ul>
<p>One way to address these important questions is through
<strong>marginal false discovery rates</strong> (mFdr). In the mFdr
framework, I can estimate an mFdr value for each value of <span class="math inline">\(\lambda\)</span> in a penalized regression model.
This gives me another way to compare different models. Instead of just
comparing the cross-validation error, I can also compare the number of
probable false discoveries out of all the features chosen in each
model.</p>
<p>For those interested in the statistical theory behind this method, I
recommend my advisor’s <a href="https://myweb.uiowa.edu/pbreheny/7240/s23/notes/3-30.pdf" class="external-link">free
online lecture notes</a>. In this article, I will use the
<code><a href="../reference/mfdr.html">mfdr()</a></code> function to illustrate how marginal false discovery
rates can be used to compare models fit with <code><a href="../reference/plmm.html">plmm()</a></code> and
<code><a href="../reference/cv.plmm.html">cv.plmm()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="admix-data">Admix data<a class="anchor" aria-label="anchor" href="#admix-data"></a>
</h3>
<p>Let’s begin with a simple example using our semi-simulated <a href="man/admix.Rd">admix data</a>. I will compare 3 models:</p>
<ul>
<li>fit 1: a model with all singular values and no fixed effects.</li>
<li>fit 2: a model with only <span class="math inline">\(k\)</span>
singular values and no fixed effects.</li>
<li>fit 3: a model with only <span class="math inline">\(k\)</span>
singular values and top 4 principal components as fixed effects.</li>
</ul>
<p>For each fit, I will use cross validation to select the value of
<span class="math inline">\(\lambda\)</span> that is best for
prediction.</p>
<div class="section level4">
<h4 id="fit-1">fit 1<a class="anchor" aria-label="anchor" href="#fit-1"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct a cross-validated lasso model </span></span>
<span><span class="va">cv_fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">y</span>,</span>
<span>              penalty <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>              <span class="co"># remember to set a seed for reproducibility </span></span>
<span>              seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># look at results </span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="va">cv_fit1</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_fit1</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized model with n=197and p=100</span></span>
<span><span class="co">#&gt; At minimum cross-validation error (lambda=0.0302):</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients: 77</span></span>
<span><span class="co">#&gt;   Cross-validation error (deviance): 2.22</span></span>
<span><span class="co">#&gt;   Scale estimate (sigma): 1.491</span></span>
<span><span class="co"># Calculate mFdr</span></span>
<span><span class="co"># head(mfdr(fit1))</span></span>
<span><span class="va">mfdr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span><span class="op">[</span><span class="va">cv_fit1</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fit-2">fit 2<a class="anchor" aria-label="anchor" href="#fit-2"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># choose k </span></span>
<span><span class="va">admix</span><span class="op">$</span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_k.html">choose_k</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X</span>, returnKapprox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting k value is 19</span></span>
<span><span class="co">#&gt; Step size is 19</span></span>
<span><span class="co">#&gt; Calcuating the relatedness matrix</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 38</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 57</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 76</span></span>
<span><span class="co">#&gt; K approximation within specified epsilon reached at k = 76</span></span>
<span></span>
<span><span class="co"># construct the model </span></span>
<span><span class="va">cv_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                   K <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">k</span><span class="op">$</span><span class="va">K_svd</span>,</span>
<span>                   penalty <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                   seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in set.seed(seed): '.Random.seed' is not an integer vector but of type</span></span>
<span><span class="co">#&gt; 'NULL', so ignored</span></span>
<span></span>
<span><span class="co"># look at results </span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="va">cv_fit2</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_fit2</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized model with n=197and p=100</span></span>
<span><span class="co">#&gt; At minimum cross-validation error (lambda=0.0215):</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients: 64</span></span>
<span><span class="co">#&gt;   Cross-validation error (deviance): 2.23</span></span>
<span><span class="co">#&gt;   Scale estimate (sigma): 1.492</span></span>
<span><span class="co"># Calculate mFdr</span></span>
<span><span class="co"># head(mfdr(fit2))</span></span>
<span><span class="va">mfdr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span><span class="op">[</span><span class="va">cv_fit2</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fit-3">fit 3<a class="anchor" aria-label="anchor" href="#fit-3"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># standardize design matrix and remove constant features </span></span>
<span><span class="va">std_X</span> <span class="op">&lt;-</span> <span class="fu">ncvreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ncvreg/man/std.html" class="external-link">std</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="co"># calculate PCs from *standardized* data</span></span>
<span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">std_X</span>, center <span class="op">=</span> <span class="cn">F</span>, scale <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="co"># plot the top 10 PCs in a scree plot </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>     y <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">proportions</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">'Proportion of variance explained'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'PC'</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'Scree Plot'</span><span class="op">)</span></span></code></pre></div>
<p><img src="mfdr_files/figure-html/pca-1.png" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first 4 PCs explain most of the variance, so we will use these as fixed effects; this makes sense given the ancestry of the participants </span></span>
<span><span class="va">pca_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>race <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">race</span>, PC1 <span class="op">=</span> <span class="va">pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, PC2 <span class="op">=</span> <span class="va">pca</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">pca_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pca_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, col <span class="op">=</span> <span class="va">race</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pca_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="mfdr_files/figure-html/pca-2.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">PCs</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="co"># look at the PCs </span></span>
<span><span class="co"># pca$x[1:5, 1:4]</span></span>
<span><span class="co"># incorporate 4 PCs as fixed effects </span></span>
<span><span class="va">admix</span><span class="op">$</span><span class="va">X_plus_PCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">PCs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p>With the principal components calculated, we can now fit our third
model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># choose k using new design matrix</span></span>
<span><span class="va">admix</span><span class="op">$</span><span class="va">k_plus_PCs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_k.html">choose_k</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X_plus_PCs</span>, returnKapprox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Starting k value is 19</span></span>
<span><span class="co">#&gt; Step size is 19</span></span>
<span><span class="co">#&gt; Calcuating the relatedness matrix</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 38</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 57</span></span>
<span><span class="co">#&gt; Stepping up to next k value: k = 76</span></span>
<span><span class="co">#&gt; K approximation within specified epsilon reached at k = 76</span></span>
<span></span>
<span><span class="co"># construct the model </span></span>
<span><span class="va">cv_fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X_plus_PCs</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                   K <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">k_plus_PCs</span><span class="op">$</span><span class="va">K_svd</span>,</span>
<span>                   penalty <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>                   <span class="co"># make sure not to penalize fixed effects - we want to keep </span></span>
<span>                   <span class="co">#  these in the model!</span></span>
<span>                   penalty.factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in set.seed(seed): '.Random.seed' is not an integer vector but of type</span></span>
<span><span class="co">#&gt; 'NULL', so ignored</span></span>
<span></span>
<span><span class="co"># look at results </span></span>
<span><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="va">cv_fit3</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_fit3</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized model with n=197and p=104</span></span>
<span><span class="co">#&gt; At minimum cross-validation error (lambda=0.0989):</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients: 29</span></span>
<span><span class="co">#&gt;   Cross-validation error (deviance): 2.81</span></span>
<span><span class="co">#&gt;   Scale estimate (sigma): 1.676</span></span>
<span><span class="co"># Calculate mFdr</span></span>
<span><span class="co"># head(mfdr(fit3))</span></span>
<span><span class="va">mfdr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span><span class="op">[</span><span class="va">cv_fit3</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="comparisons">Comparisons<a class="anchor" aria-label="anchor" href="#comparisons"></a>
</h3>
<p>Let’s compare the results from these three models using the admix
data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># columns are ordered by models 1-3</span></span>
<span><span class="co"># rows are CV plots &amp; coefficient path plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_fit1</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_fit2</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_fit3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit3</span><span class="op">)</span></span></code></pre></div>
<p><img src="mfdr_files/figure-html/admix_comparison-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">admix_comparison</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">mfdr1</span>, <span class="va">mfdr2</span>, <span class="va">mfdr3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">EF</span>, <span class="va">mFDR</span><span class="op">)</span>,</span>
<span>                .fns <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">admix_comparison</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">lambda</th>
<th align="right">EF</th>
<th align="right">S</th>
<th align="right">mFDR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0.0302</td>
<td align="right">12.128</td>
<td align="right">76</td>
<td align="right">0.160</td>
</tr>
<tr class="even">
<td align="left">0.0215</td>
<td align="right">2.512</td>
<td align="right">63</td>
<td align="right">0.040</td>
</tr>
<tr class="odd">
<td align="left">0.0989</td>
<td align="right">0.055</td>
<td align="right">24</td>
<td align="right">0.002</td>
</tr>
</tbody>
</table>
<p>Some observations based on the plots and output above:</p>
<ul>
<li>The CV plot has the clearest pattern for fit 3</li>
<li>Fits 2 and 3 have comparable marginal false discovery rates of about
4%, which is much lower (better) than the 16% mFdr for fit 1.</li>
<li>The number of selected variables is higher for the second fit.
<strong>Question</strong>: could this mean that adding the PCs is
decreasing power? I am still thinking about this…</li>
</ul>
<p>Marginal false discovery rates also give us another way to select
<span class="math inline">\(\lambda\)</span>: instead of choosing the
<span class="math inline">\(\lambda\)</span> value that minimizes cross
validation error, I could choose the value that limits the mFdr at a
certain level. We can examine this approach for the models we fit
above:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># let's look at the smallest lambda for which mFdr is &lt; 10% in each fit </span></span>
<span><span class="co"># TODO: I am still working to 'iron this out' </span></span>
<span><span class="co"># fit 1 </span></span>
<span><span class="va">bestlam1</span> <span class="op">&lt;-</span> <span class="va">fit1</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="va">mfdr1</span><span class="op">$</span><span class="va">mFDR</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">mfdr1_res</span> <span class="op">&lt;-</span> <span class="va">mfdr1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bestlam1</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># fit 2 </span></span>
<span><span class="va">bestlam2</span> <span class="op">&lt;-</span> <span class="va">fit2</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="va">mfdr2</span><span class="op">$</span><span class="va">mFDR</span> <span class="op">&lt;</span> <span class="fl">0.2</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">mfdr2_res</span> <span class="op">&lt;-</span> <span class="va">mfdr2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bestlam2</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># fit 3 </span></span>
<span><span class="va">bestlam3</span> <span class="op">&lt;-</span> <span class="va">fit3</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="va">mfdr3</span><span class="op">$</span><span class="va">mFDR</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">mfdr3_res</span> <span class="op">&lt;-</span> <span class="va">mfdr3</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">bestlam3</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="penncath-data-high-dimensional">Penncath data (high dimensional)<a class="anchor" aria-label="anchor" href="#penncath-data-high-dimensional"></a>
</h3>
<p>Let’s do a similar model comparison, this time using the
<code>penncath_lite</code> data.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># process PLINK files with penncath data</span></span>
<span><span class="co"># NB: you only need to do this step the first time you process the raw data.</span></span>
<span><span class="va">penncath_lite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_plink.html">process_plink</a></span><span class="op">(</span></span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="../reference/plink_example.html">plink_example</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  prefix <span class="op">=</span> <span class="st">"penncath_lite"</span>,</span>
<span>  gz <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># NB: PLINK data that ships with package comes gzipped</span></span>
<span>  impute <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># mode imputation is default </span></span>
<span>  outfile <span class="op">=</span> <span class="st">"process_penncath"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the processed penncath data </span></span>
<span><span class="va">pen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="../reference/plink_example.html">plink_example</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"/penncath_lite"</span><span class="op">)</span>,</span>
<span>                returnX <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>These data represent 1,401 individuals and 4,367 SNPs from a GWAS
study. For the sake of example, let’s use <a href="https://www.cdc.gov/cholesterol/ldl_hdl.htm#:~:text=HDL%20(high%2Ddensity%20lipoprotein),for%20heart%20disease%20and%20stroke." class="external-link">hdl</a>
(high-density lipoprotein cholesterol) as our outcome.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in the clinical data</span></span>
<span><span class="va">pen_clinical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="../reference/plink_example.html">plink_example</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                             <span class="st">"/penncath_clinical.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>family.ID <span class="op">=</span> <span class="va">FamID</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># several choices of outcome here;</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">pen_clinical</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># choose hdl as outcome; impute missing values with the mean</span></span>
<span><span class="va">pen</span><span class="op">$</span><span class="va">fam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">fam</span>, <span class="va">pen_clinical</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="st">"family.ID"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pen</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">fam</span><span class="op">$</span><span class="va">hdl</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">fam</span><span class="op">$</span><span class="va">hdl</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="va">pen</span><span class="op">$</span><span class="va">fam</span><span class="op">$</span><span class="va">hdl</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="fit-1-1">fit 1<a class="anchor" aria-label="anchor" href="#fit-1-1"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># construct a cross-validated lasso model </span></span>
<span><span class="va">cv_pen1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">X</span>,</span>
<span>              y <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">y</span>,</span>
<span>              penalty <span class="op">=</span> <span class="st">"lasso"</span>,</span>
<span>              <span class="co"># remember to set a seed for reproducibility </span></span>
<span>              seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># look at results </span></span>
<span><span class="va">pen1</span> <span class="op">&lt;-</span> <span class="va">cv_pen1</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_pen1</span><span class="op">)</span></span>
<span><span class="co"># Calculate mFdr</span></span>
<span><span class="co"># head(mfdr(pen1))</span></span>
<span><span class="op">(</span><span class="va">pen_mfdr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen1</span><span class="op">)</span><span class="op">[</span><span class="va">cv_pen1</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Hmm – we found an mFdr of 1 in fit 1, which is not great from an
application standpoint. While this could be due to a true lack of
association between any SNPs and the HDL outcome, this may also be an
estimation issue. In our next model, we will use MCP instead of lasso in
hopes of improving our estimation.</p>
</div>
<div class="section level4">
<h4 id="fit-2-1">fit 2<a class="anchor" aria-label="anchor" href="#fit-2-1"></a>
</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pen</span><span class="op">$</span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/choose_k.html">choose_k</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">X</span>, returnKapprox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_pen2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">X</span>,</span>
<span>        y <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">y</span>,</span>
<span>        K <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">k</span><span class="op">$</span><span class="va">K_svd</span>,</span>
<span>        seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pen2</span> <span class="op">&lt;-</span> <span class="va">cv_pen2</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_pen2</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">pen_mfdr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen2</span><span class="op">)</span><span class="op">[</span><span class="va">cv_pen2</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fit-3-1">fit 3<a class="anchor" aria-label="anchor" href="#fit-3-1"></a>
</h4>
<p>Finally, we will model the ‘penncath’ data one more time using sex,
age, and the first few principal components</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pen</span><span class="op">$</span><span class="va">std_X</span> <span class="op">&lt;-</span> <span class="fu">ncvreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ncvreg/man/std.html" class="external-link">std</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">pen_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">std_X</span>, center <span class="op">=</span> <span class="cn">F</span>, scale. <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># scree plot </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>     y <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">proportions</a></span><span class="op">(</span><span class="va">pen_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>     type <span class="op">=</span> <span class="st">'b'</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">'Proportion of variance explained'</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">'PC'</span>,</span>
<span>     main <span class="op">=</span> <span class="st">'Scree Plot'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># will use 10 PCs as fixed effects </span></span>
<span><span class="va">pen_PCs</span> <span class="op">&lt;-</span> <span class="va">pen_pca</span><span class="op">$</span><span class="va">x</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pen</span><span class="op">$</span><span class="va">X_plus_fixed_eff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">fam</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span><span class="op">]</span>, <span class="va">pen_PCs</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">pen</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TODO: the following line needs troubleshooting</span></span>
<span><span class="co"># pen$k_plus_pcs &lt;- choose_k(X = pen$X_plus_fixed_eff,</span></span>
<span><span class="co">#                            # start at 1200 based on result from the previous fit</span></span>
<span><span class="co">#                            start = 1200,</span></span>
<span><span class="co">#                            returnKapprox = T)</span></span>
<span></span>
<span><span class="va">cv_pen3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.plmm.html">cv.plmm</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">X_plus_fixed_eff</span>,</span>
<span>                   y <span class="op">=</span> <span class="va">pen</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                    <span class="co"># start at 1200 based on result from the previous fit</span></span>
<span>                   k <span class="op">=</span> <span class="fl">1200</span>,</span>
<span>                   penalty.factor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">pen</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   seed <span class="op">=</span> <span class="fl">26</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pen3</span> <span class="op">&lt;-</span> <span class="va">cv_pen3</span><span class="op">$</span><span class="va">fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_pen3</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">pen_mfdr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen3</span><span class="op">)</span><span class="op">[</span><span class="va">cv_pen3</span><span class="op">$</span><span class="va">min</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="comparisons-1">Comparisons<a class="anchor" aria-label="anchor" href="#comparisons-1"></a>
</h3>
<p>Comparing the three fits with the ‘penncath’ data, we can observe the
following:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_pen1</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_pen2</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_pen3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pen1</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pen2</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pen3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pen_comparison</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">pen_mfdr1</span>, <span class="va">pen_mfdr2</span>, <span class="va">pen_mfdr3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">EF</span>, <span class="va">mFDR</span><span class="op">)</span>,</span>
<span>                .fns <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">.x</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">pen_comparison</span><span class="op">)</span></span></code></pre></div>
<p>We can also look at how mFDR changes among the three models:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_mfdr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen1</span><span class="op">)</span>, <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen2</span><span class="op">)</span>, <span class="fu"><a href="../reference/mfdr.html">mfdr</a></span><span class="op">(</span><span class="va">pen3</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"lambda"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"lasso"</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"MCP + trunc. SVD"</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'MCP + trunc. SVD + fixed eff'</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         log_lam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">compare_mfdr</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">log_lam</span>, y <span class="op">=</span> <span class="va">mFDR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="local-false-discovery-rates">Local false discovery rates<a class="anchor" aria-label="anchor" href="#local-false-discovery-rates"></a>
</h2>
<p>At the beginning of this vignette, we examined some important
questions of inference. Let’s consider an additional question that often
arises in practice: “Can we assess which of the features (e.g., which
SNPs, or which predictors) are most likely to be false discoveries, and
which features are most likely to be truly connected to the outcome I
care about?”. This is a question about the individual features, rather
than about a model. One way to address this question is with
<strong>local marginal false discovery rates</strong> (lmfdr). The local
mFdr framework takes mFdr to the feature level, so that an mFdr value is
estimated for each <span class="math inline">\(\hat \beta\)</span> in a
penalized regression model. Using these mFdr values, I can then rank the
selected features on a scale from 0 to 1. A feature with an mFdr value
closer to zero has a high probability of being associated with the
outcome of interest, whereas a feature with an mFdr value closer to 1 is
probably a false discovery.</p>
<p>Example to come here… in the future, I want to adapt
<code>ncvreg:::local_mfdr()</code> to work with PLMMs.</p>
</div>
<div class="section level2">
<h2 id="references-acknowledgements">References &amp; acknowledgements<a class="anchor" aria-label="anchor" href="#references-acknowledgements"></a>
</h2>
<p>The <code><a href="../reference/mfdr.html">mfdr()</a></code> function I have incorporated here in our
<code>penalizedLMM</code> package is based on Ryan Miller’s joint work
with Patrick Breheny in the <code><a href="https://rdrr.io/pkg/ncvreg/man/mfdr.html" class="external-link">ncvreg::mfdr()</a></code> package. To read
more about their work, see <a href="https://doi.org/10.1002/sim.9678" class="external-link">Miller &amp; Breheny (2023) in
Stats in Medicine</a>.</p>
<p>Penncath data: These data describe coronary artery disease outcomes
from the <a href="https://pubmed.ncbi.nlm.nih.gov/21239051/" class="external-link">PennCath
study</a>). This data set is a subset of a much larger data set (the
original data has over 800K SNPs); I chose to create a ‘lite’ version
for vignette purposes. For for information on this data set, refer to
the <a href="https://pubmed.ncbi.nlm.nih.gov/21239051/" class="external-link">original
publication</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Anna C. Reisetter, Patrick J. Breheny, Tabitha K. Peter, Yujiing Lu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
